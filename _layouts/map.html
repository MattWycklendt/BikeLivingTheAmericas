<!DOCTYPE html>
<html lang="en">

{% include head.html %}

<body>

    {% include nav.html %}


<!-- Page Header -->
<!--
<header>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
</header>
-->


<!-- Main Content -->
<!-- Need a 50px buffer... There is probably a better way to do this-->
<div class="row" style="height: 50px;"></div>
<div class="row" id="map"></div>


<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.0/jquery.min.js"></script>
<!--<script src="https://maps.googleapis.com/maps/api/js?callback=initMap" async defer></script>-->
<!--<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js"></script>-->
<script type="text/javascript"
  src="https://maps.googleapis.com/maps/api/js?libraries=geometry">
</script>

<script>

//function initMap() {

    var customMapType = new google.maps.StyledMapType(
    [
        {
            "stylers": [
                {
                    "saturation": -100
                }
            ]
        },
        {
            "featureType": "water",
            "elementType": "geometry.fill",
            "stylers": [
                {
                    "color": "#0099dd"
                }
            ]
        },
        {
            "featureType": "poi.park",
            "elementType": "geometry.fill",
            "stylers": [
                {
                    "color": "#aadd55"
                }
            ]
        },
        {
            "featureType": "road.highway",
            "elementType": "labels",
            "stylers": [
                {
                    "visibility": "on"
                }
            ]
        },
        {
            "featureType": "road.arterial",
            "elementType": "labels.text",
            "stylers": [
                {
                    "visibility": "on"
                }
            ]
        },
        {
            "featureType": "road.local",
            "elementType": "labels.text",
            "stylers": [
                {
                    "visibility": "on"
                }
            ]
        },
        {}
    ], {
        name: 'Journey'
    });

    var customMapTypeId = 'custom_style';
    var map = new google.maps.Map(document.getElementById('map'), {
        center: {lat: 61, lng: -149},
        zoom: 5,
        mapTypeControlOptions: {
            mapTypeIds: [google.maps.MapTypeId.ROADMAP, customMapTypeId]
        }
    });

    map.mapTypes.set(customMapTypeId, customMapType);
    map.setMapTypeId(customMapTypeId);

    var bounds = new google.maps.LatLngBounds ();

    function display_route(route) {
            var route;
            var steps = route.routes[0].legs[0].steps;
            var points = [];
            for (i = 0; i < steps.length; i++) {
                path = google.maps.geometry.encoding.decodePath(steps[i].polyline.points);
                for (j = 0; j < path.length; j++) {
                    var lat = path[j].G;
                    var lon = path[j].K;
                    var p = new google.maps.LatLng(lat, lon);
                    points.push(p);
                    bounds.extend(p);
                }
            };

            var poly = new google.maps.Polyline({
                // use your own style here
                path: points,
                strokeColor: "#FF00AA",
                strokeOpacity: .7,
                strokeWeight: 4
            });

            poly.setMap(map);

            // fit bounds to track
            map.fitBounds(bounds);
    };

    $.ajax({
        type: "GET",
        url: "/raw/ancorage_to_LA.json",
        dataType: "json",
        success: function(route) {
            display_route(route);
        }
    });

    $.ajax({
        type: "GET",
        url: "/raw/LA_to_LaPaz.json",
        dataType: "json",
        success: function(route) {
            display_route(route);
        }
    });

    $.ajax({
        type: "GET",
        url: "/raw/LaPaz_to_PuertoVallarta.json",
        dataType: "json",
        success: function(route) {
            display_route(route);
        }
    });

    $.ajax({
        type: "GET",
        url: "/raw/PuertoVallarta_to_Panama.json",
        dataType: "json",
        success: function(route) {
            display_route(route);
        }
    });

    $.ajax({
        type: "GET",
        url: "/raw/Turbo_to_Santiago.json",
        dataType: "json",
        success: function(route) {
            display_route(route);
        }
    });

    $.ajax({
        type: "GET",
        url: "/raw/Santiago_to_Ushuaia.json",
        dataType: "json",
        success: function(route) {
            display_route(route);
        }
    });

    $.ajax({
        type: "GET",
        url: "/raw/2015-8-30-afternoon.tcx",
        dataType: "xml",
        success: function(xml) {
            var points = [];
            var currPos;
            var bounds = new google.maps.LatLngBounds ();

            $(xml).find("Position").each(function() {
                var lat = $(this).find("LatitudeDegrees").html();
                var lon = $(this).find("LongitudeDegrees").html();
                var p = new google.maps.LatLng(lat, lon);
                points.push(p);

                currPos = p;//{'lat': int(lat), 'log': ing(clon};
                bounds.extend(p);
            });

            // Define the symbol, using one of the predefined paths ('CIRCLE')
            // supplied by the Google Maps JavaScript API.
            var lineSymbol = {
                path: google.maps.SymbolPath.CIRCLE,
                scale: 8,
                strokeColor: '#393'
            };


            var poly = new google.maps.Polyline({
                // use your own style here
                path: points,
                strokeColor: "#6600CC",
                strokeOpacity: .7,
                strokeWeight: 4,
                icons: [{
                    icon: lineSymbol,
                    offset: '100%'
                }],
            });

            poly.setMap(map);
            //animateCircle(poly);

            // fit bounds to track
            map.fitBounds(bounds);

            var marker = new google.maps.Marker({
                position: currPos,
                map: map,
                title: 'Hello World!'
            });

            // Use the DOM setInterval() function to change the offset of the symbol
            // at fixed intervals.
            function animateCircle(line) {
                var count = 0;
                window.setInterval(function() {
                    if (count === 199) {
                        return;
                    }
                    count = (count + 1) % 200;

                    var icons = line.get('icons');
                    icons[0].offset = (count / 2) + '%';
                    line.set('icons', icons);
                }, 20);
            }
        }
    });
//}


</script>

    {% include footer.html %}

</body>

</html>
